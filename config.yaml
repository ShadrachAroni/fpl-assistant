fpl:
  base_url: "https://fantasy.premierleague.com/api"
  use_session_cookie: true
  session_cookie_name: "FPLSESSION"

sources:
  xg_source: "understat"
  sportmonks:
    base_url: "https://api.sportmonks.com"
    api_token: "${SPORTMONKS_API_TOKEN}"
    injuries_endpoint: "v3/football/injuries"
    league_ids: [8, 271]           # Premier League + International competitions
    include_player_details: true
    use_xg_endpoint: true

news_intel:
  poll_minutes: 10
  keywords:
    - "injury"
    - "doubt"
    - "ruled out"
    - "hamstring"
    - "knock"
  gnews:
    api_key: "01fa88c6ba3741714168aa09ecd180d1"
    lang: "en"
    country: "gb"
  newsapi:
    api_key: "b65276f9b7e04a5aa3362805bcb06cf8"
    country: "gb"
    category: "sports"
  rss:
    - name: "BBC Sport"
      url: "https://feeds.bbci.co.uk/sport/football/rss.xml"
    - name: "The Guardian"
      url: "https://www.theguardian.com/football/rss"
    - name: "Sky Sports"
      url: "https://www.skysports.com/rss/12040"

training:
  target_window_gw: 1
  rolling_window_gw: 4
  n_splits_cv: 5
  include_fixture_difficulty: true
  output_column: "predicted_points_next_gw"
  bayesian_form_confidence: 0.7
  use_position_models: true
  optimize: true
  optimize_trials: 40

understat:
  season: "2024"
  refresh_hours: 6

simulation:
  # âœ… OPTIMAL HORIZONS - Based on FPL dynamics
  planning_horizon: 5                    # Transfer planning (sweet spot for reliability)
  chip_analysis_horizon: 10              # Chip timing (catch DGW announcements)
  fixture_analysis_horizon: 8            # Fixture runs (identify swings)

  # Multi-objective optimization weights (sum to 1.0)
  multi_objective_weights:
    points: 0.35
    safety: 0.20
    value: 0.15
    differential: 0.15
    fixtures: 0.15

  # Monte Carlo simulation settings
  monte_carlo:
    enabled: true
    simulations: 1200
    percentile_floor: 10
    percentile_ceiling: 90
  
  # Confidence decay (reduce weight for distant GWs)
  use_horizon_decay: true
  horizon_confidence_decay:
    1: 1.00    # 100% confidence in next GW
    2: 0.95    # 95% confidence
    3: 0.90    # 90% confidence  
    4: 0.82    # 82% confidence
    5: 0.75    # 75% confidence (end of reliable transfer planning)
    6: 0.65    # Fixture planning only beyond this
    7: 0.55
    8: 0.45    # End of reliable fixture analysis
    9: 0.35    # Chip analysis only
    10: 0.25   # Maximum chip horizon
  
  consider_fixture_difficulty: true
  max_transfers_per_gw: 2
  transfer_cost: 4
  free_transfers_default: 1
  transfer_hit: -4
  suggest_captaincy: true
  suggest_chip_usage: true
  min_expected_points_gain_for_chip: 5.0
  
  # Transfer Risk Management
  transfer_risk:
    min_gain_for_free_transfer: 1.0      # Minimum for using 1 FT
    min_gain_for_hit: 6.0                # Minimum to justify -4pt hit
    extra_transfer_multiplier: 1.5       # 2nd transfer needs 1.5x the cost
    allow_aggressive_transfers: true     # Enable when underperforming
    underperformance_threshold: 45       # Avg pts threshold
    
  # ðŸ†• COMPREHENSIVE RISK ASSESSMENT
  risk_assessment:
    # Risk factor weights (total = 1.0)
    injury_risk_weight: 0.25             # Injury/availability
    news_severity_weight: 0.10           # News status
    rotation_risk_weight: 0.20           # Minutes volatility
    disciplinary_risk_weight: 0.15       # Yellow cards/suspension
    fatigue_risk_weight: 0.10            # Fatigue tracking
    form_drop_risk_weight: 0.15          # Form trend
    defensive_fragility_weight: 0.03     # Team defense (DEF/GK)
    penalty_risk_weight: 0.02            # Penalty status
    
    # Risk thresholds
    high_risk_threshold: 0.6             # Above this = high risk
    medium_risk_threshold: 0.3           # Below this = low risk
    
    # Risk penalties (applied to predicted points)
    max_total_risk_penalty: 0.30         # Max 30% penalty for total risk
    high_injury_risk_penalty: 0.20       # Extra 20% if injury >50%
    rotation_prone_penalty: 0.15         # Extra 15% if rotation >70%
    suspension_risk_penalty: 0.10        # Extra 10% if disciplinary >60%
    fatigue_penalty: 0.08                # Extra 8% if fatigue >60%
    
    # Rotation-prone managers (known for heavy rotation)
    rotation_prone_teams:
      - "Manchester City"      # Guardiola - Pep roulette
      - "Chelsea"              # High rotation
      - "Liverpool"            # Slot era rotation
      - "Tottenham Hotspur"    # Postecoglou tinkering
      - "Brighton and Hove Albion"
      - "Newcastle United"
    
    # Yellow card suspension thresholds
    yellow_card_thresholds:
      3: 0.3            # 3 yellows = 30% risk
      4: 0.6            # 4 yellows = 60% risk
      5: 0.9            # 5 yellows = 90% risk (1 match ban)
      10: 1.0           # 10 yellows = certain ban (2 matches)
    
    # Minutes reliability thresholds
    minutes_per_game_thresholds:
      70: 0.0           # 70+ min/game = no rotation risk
      60: 0.14          # 60-69 min/game = 14% risk
      45: 0.36          # 45-59 min/game = 36% risk
      30: 0.57          # 30-44 min/game = 57% risk
      0: 1.0            # <30 min/game = 100% risk
    
    # Fatigue thresholds (total minutes played)
    fatigue_thresholds:
      1000: 0.0         # <1000 min = no fatigue
      1500: 0.2         # 1000-1499 min = 20% fatigue
      2000: 0.4         # 1500-1999 min = 40% fatigue
      2500: 0.6         # 2000-2499 min = 60% fatigue
      2501: 0.8         # 2500+ min = 80% fatigue
    
    # DGW fatigue multiplier
    dgw_fatigue_multiplier: 1.3          # 30% extra fatigue risk in DGW
    
    # Form drop thresholds
    form_thresholds:
      3.0: 1.0          # <3.0 form = 100% risk
      4.0: 0.7          # 3.0-3.9 form = 70% risk
      5.0: 0.5          # 4.0-4.9 form = 50% risk
      6.0: 0.2          # 5.0-5.9 form = 20% risk
      6.1: 0.0          # 6.0+ form = no risk
    
    # Risk-aware transfer selection
    reject_high_risk_second_transfer: true  # Don't recommend risky 2nd transfer
    high_risk_second_transfer_threshold: 0.7  # Max risk for 2nd transfer
    
    # Risk warnings
    enable_risk_warnings: true
    warn_on_medium_risk: true
    warn_on_high_risk: true
    
  # Chip Timing Optimization
  chip_timing:
    triple_captain:
      require_double_gameweek: true      # Prefer DGW (but not mandatory)
      min_predicted_points: 12.0         # Minimum captain prediction
      easy_fixture_threshold: 2          # Max difficulty for "easy"
      dgw_bonus_multiplier: 1.5          # Extra value for DGW
      optimal_gw_range: [0, 10]          # Search within 10 GWs
      use_risk_adjusted_scores: true     # Use risk-adjusted predictions
      
    bench_boost:
      require_double_gameweek: true      # Prefer DGW
      min_bench_total_points: 20.0       # Minimum bench prediction
      min_players_with_fixtures: 4       # All bench must play
      dgw_bonus_multiplier: 1.5          # Extra value for DGW
      optimal_gw_range: [0, 10]          # Search within 10 GWs
      use_risk_adjusted_scores: true     # Use risk-adjusted predictions
      
    free_hit:
      blank_gw_priority: true            # Prioritize blank GWs
      min_fixture_advantage: 15.0        # Min points gain vs current squad
      consider_dgw_without_players: true # Use if <8 DGW players
      min_dgw_players_threshold: 8       # Threshold for DGW consideration
      optimal_gw_range: [0, 10]          # Search within 10 GWs
      
    wildcard:
      min_team_efficiency: 0.75          # Squad efficiency threshold
      min_transfers_needed: 4            # Min problematic players
      injury_crisis_threshold: 3         # Auto-recommend if 3+ injuries
      high_risk_players_threshold: 4     # Auto-recommend if 4+ high-risk
      fixture_run_importance: 0.6        # Weight for upcoming fixtures
      optimal_gw_range: [0, 8]           # Look 8 GWs ahead for fixtures
      use_risk_adjusted_efficiency: true # Consider risk in efficiency calc

  # Fixture Analysis Settings
  fixture_analysis:
    easy_fixture_threshold: 2            # Difficulty â‰¤ 2 = easy
    hard_fixture_threshold: 4            # Difficulty â‰¥ 4 = hard
    good_run_length: 3                   # 3+ easy fixtures = good run
    bad_run_length: 3                    # 3+ hard fixtures = bad run
    fixture_weight_by_distance:          # Reduce weight for distant fixtures
      1: 1.0
      2: 0.95
      3: 0.90
      4: 0.85
      5: 0.80
      6: 0.70
      7: 0.60
      8: 0.50

  # Performance Analysis
  performance_tracking:
    recent_weeks_to_analyze: 5           # Check last 5 GWs for form
    underperformance_consecutive_weeks: 3 # Trigger aggressive after 3 poor GWs
    poor_week_threshold: 40              # <40 pts = poor week

cache:
  enabled: true
  path: "./.cache/db.sqlite"

# External injury intelligence
injury_intel:
  external_sources_enabled: true
  refresh_minutes: 60
  fallback_chance_percent: 25
  high_severity_threshold: 0.85
  medium_severity_threshold: 0.6
  default_severity: 0.75
  priority_competitions:
    - "Premier League"
    - "UEFA Champions League"
    - "UEFA Europa League"
    - "International"
  premier_league_api:
    comp_seasons: [719]
    page_size: 40

lineup_intel:
  enabled: true
  refresh_minutes: 20
  pre_kickoff_window_minutes: 180
  allow_historical_lookup: true

# Market intelligence controls
market_intelligence:
  price_rise_base_threshold: 100000         # Baseline transfers for price change
  threshold_multiplier: 1.2                 # Multiplier for "rising tonight"
  likely_multiplier: 0.8                    # Multiplier for "likely rising"
  template_penalty_captain: 0.5             # Penalty for template captains
  template_penalty_player: 0.3              # Penalty for template players

# Real-world context inputs
contextual_intel:
  manager_changes:
    "Chelsea": 2        # GW since manager change
    "Manchester United": 5
    "Brighton and Hove Albion": 1
  european_competitions:
    champions_league:
      - "Manchester City"
      - "Arsenal"
      - "Liverpool"
      - "Chelsea"
    europa_league:
      - "Tottenham Hotspur"
      - "Newcastle United"
    conference_league:
      - "Aston Villa"

# Model performance reporting targets
model_performance:
  min_score: 90.0
  target_rmse: 2.0
  target_mae: 1.2
  target_r2: 0.65
  baseline_points: 6.0

# Logging Configuration
logging:
  level: "INFO"                          # INFO | DEBUG | WARNING
  log_transfer_analysis: true            # Log detailed transfer analysis
  log_chip_analysis: true                # Log chip opportunity analysis
  log_rejected_transfers: true           # Log why transfers were rejected
  log_horizon_predictions: false         # Don't spam with all predictions
  log_risk_assessment: true              # Log comprehensive risk analysis
  log_risk_warnings: true                # Log player risk warnings